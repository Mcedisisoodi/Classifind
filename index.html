<!DOCTYPE html>
<html lang="en">
<head>

  <!-- SUPABASE INITIALIZATION -->
<script type="module">
  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2";

  const SUPABASE_URL = "https://vmgpyjpbxfvnttnjbpsa.supabase.co";
  const SUPABASE_KEY = "sb_publishable_eFTbKKlL1mileWxBduPXDQ_zZDUAtOW";

  const client = createClient(SUPABASE_URL, SUPABASE_KEY);

  window.supabaseClient = client;
</script>

  <meta charset="UTF-8" />
  <title>ClassiFind ‚Äì Local Classifieds</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      background: #f5f5f5;
      color: #222;
    }

    header {
      background: #002f34;
      color: #fff;
      padding: 12px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .logo {
      font-weight: 800;
      font-size: 1.2rem;
      letter-spacing: 1px;
    }

    .logo span {
      color: #ffce32;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .btn {
      border-radius: 20px;
      padding: 6px 14px;
      border: 1px solid #fff;
      background: transparent;
      color: #fff;
      cursor: pointer;
      font-size: 0.9rem;
    }

    .btn.primary {
      background: #ffce32;
      border-color: #ffce32;
      color: #002f34;
      font-weight: 600;
    }

    main {
      max-width: 1100px;
      margin: 0 auto;
      padding: 16px;
    }

    .search-section {
      background: #fff;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
    }

    .search-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .search-row input,
    .search-row select {
      flex: 1 1 180px;
      padding: 10px 12px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 0.95rem;
    }

    .search-row button {
      padding: 10px 20px;
      border-radius: 6px;
      border: none;
      background: #002f34;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      flex: 0 0 auto;
    }

    .section-title {
      margin: 16px 0 8px;
      font-size: 1.05rem;
      font-weight: 600;
    }

    .categories {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 8px;
      margin-bottom: 16px;
    }

    .category-card {
      background: #fff;
      border-radius: 8px;
      padding: 10px;
      text-align: center;
      cursor: pointer;
      font-size: 0.9rem;
      border: 1px solid transparent;
      transition: border 0.15s, box-shadow 0.15s, transform 0.1s;
    }

    .category-card:hover {
      border-color: #002f34;
      box-shadow: 0 1px 4px rgba(0,0,0,0.12);
      transform: translateY(-1px);
    }

    .category-icon {
      font-size: 1.5rem;
      margin-bottom: 4px;
    }

    .ads-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
      gap: 12px;
    }

    .ad-card {
      background: #fff;
      border-radius: 8px;
      overflow: hidden;
      border: 1px solid #ddd;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      transition: box-shadow 0.15s, transform 0.1s;
    }

    .ad-card:hover {
      box-shadow: 0 1px 6px rgba(0,0,0,0.15);
      transform: translateY(-1px);
    }

    .ad-image {
      height: 160px;
      background-size: cover;
      background-position: center;
      background-color: #eee;
    }

    .ad-body {
      padding: 10px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      flex: 1;
    }

    .ad-price {
      font-weight: 700;
      font-size: 1rem;
    }

    .ad-title {
      font-size: 0.95rem;
      font-weight: 500;
    }

    .ad-location {
      font-size: 0.8rem;
      color: #555;
    }

    .ad-meta {
      font-size: 0.75rem;
      color: #888;
      margin-top: 4px;
    }

    .filters {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 8px 0 16px;
    }

    .filters select {
      padding: 6px 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 0.85rem;
    }

    footer {
      margin-top: 32px;
      padding: 16px;
      text-align: center;
      font-size: 0.8rem;
      color: #666;
    }

    /* Ad details modal */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 20;
    }

    .modal {
      background: #fff;
      max-width: 600px;
      width: 95%;
      border-radius: 10px;
      overflow: hidden;
    }

    .modal-header {
      padding: 10px 14px;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-header h2 {
      font-size: 1rem;
    }

    .modal-body {
      padding: 14px;
      display: grid;
      grid-template-columns: 1.3fr 1fr;
      gap: 12px;
    }

    .modal-img {
      height: 220px;
      background-size: cover;
      background-position: center;
      border-radius: 8px;
      background-color: #eee;
    }

    .modal-section-title {
      font-size: 0.85rem;
      text-transform: uppercase;
      color: #777;
      margin-bottom: 4px;
    }

    .contact-btn {
      margin-top: 10px;
      width: 100%;
      padding: 10px;
      border-radius: 6px;
      border: none;
      background: #002f34;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
    }

    .close-btn {
      background: none;
      border: none;
      font-size: 1.2rem;
      cursor: pointer;
    }

    @media (max-width: 640px) {
      .modal-body {
        grid-template-columns: 1fr;
      }
    }

    /* Auth modal styles */
    .auth-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 30;
    }

    .auth-modal {
      background: #fff;
      width: 95%;
      max-width: 420px;
      border-radius: 10px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.25);
      overflow: hidden;
    }

    .auth-header {
      padding: 12px 16px;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #002f34;
      color: #fff;
    }

    .auth-header h2 {
      font-size: 1rem;
      font-weight: 600;
    }

    .auth-close {
      background: none;
      border: none;
      font-size: 1.2rem;
      color: #fff;
      cursor: pointer;
    }

    .auth-body {
      padding: 16px;
    }

    .auth-body label {
      display: block;
      font-size: 0.8rem;
      margin-bottom: 4px;
      color: #555;
    }

    .auth-body input {
      width: 100%;
      padding: 8px 10px;
      margin-bottom: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 0.9rem;
    }

    .auth-actions {
      margin-top: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      font-size: 0.8rem;
    }

    .auth-link {
      color: #007bff;
      text-decoration: underline;
      cursor: pointer;
      font-weight: 600;
    }

    .auth-submit {
      width: 100%;
      padding: 10px;
      border-radius: 6px;
      border: none;
      background: #002f34;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      margin-top: 4px;
    }

    /* Password helpers */
    .auth-body .field-group {
      position: relative;
      margin-bottom: 10px;
    }

    .auth-body .field-group input {
      padding-right: 36px;
    }

    .toggle-password {
      position: absolute;
      right: 8px;
      top: 28px;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 0.9rem;
      color: #555;
    }

    .password-strength {
      margin-top: 4px;
      font-size: 0.75rem;
    }

    .password-strength .bar {
      height: 4px;
      width: 0;
      border-radius: 999px;
      background: #ccc;
      margin-bottom: 3px;
      transition: width 0.2s ease, background-color 0.2s ease;
    }

    .password-strength.weak .bar {
      background: #2e7d32;
      width: 33%;
    }

    .password-strength.medium .bar {
      background: #2e7d32;
      width: 66%;
    }

    .password-strength.strong .bar {
      background: #2e7d32;
      width: 100%;
    }

    .password-strength .label {
      color: #555;
    }

    .password-match-msg {
      font-size: 0.75rem;
      margin-top: 4px;
    }

    .password-match-msg.ok {
      color: #2e7d32;
    }

    .password-match-msg.error {
      color: #c62828;
    }

    /* Post Ad modal */
    .postad-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 25;
    }

    .postad-modal {
      background: #fff;
      width: 95%;
      max-width: 600px;
      border-radius: 10px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.25);
      overflow: hidden;
    }

    .postad-header {
      padding: 12px 16px;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #002f34;
      color: #fff;
    }

    .postad-header h2 {
      font-size: 1rem;
      font-weight: 600;
    }

    .postad-close {
      background: none;
      border: none;
      font-size: 1.2rem;
      color: #fff;
      cursor: pointer;
    }

    .postad-body {
      padding: 16px;
    }

    .postad-body label {
      display: block;
      font-size: 0.8rem;
      margin-bottom: 4px;
      color: #555;
    }

    .postad-body input,
    .postad-body textarea,
    .postad-body select {
      width: 100%;
      padding: 8px 10px;
      margin-bottom: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 0.9rem;
    }

    .postad-body textarea {
      resize: vertical;
      min-height: 80px;
    }

    .postad-submit {
      width: 100%;
      padding: 10px;
      border-radius: 6px;
      border: none;
      background: #ffce32;
      color: #002f34;
      font-weight: 700;
      cursor: pointer;
      margin-top: 4px;
    }

    .postad-note {
      font-size: 0.75rem;
      color: #777;
      margin-top: 4px;
    }
  </style>
</head>
<body>
<header>
  <div class="logo">Classi<span>Find</span></div>
  <div class="header-actions">
    <button class="btn" id="loginBtn">Login</button>
    <button class="btn" id="signupBtn">Sign up</button>
    <button class="btn primary" id="postAdBtn">+ Post Ad</button>
  </div>
</header>

<main>
  <section class="search-section">
    <div class="search-row">
      <input id="searchText" type="text" placeholder="Find cars, phones, property..." />

      <select id="provinceSelect">
        <option value="All provinces">All provinces</option>
        <option value="Gauteng">Gauteng</option>
        <option value="Western Cape">Western Cape</option>
        <option value="KwaZulu-Natal">KwaZulu-Natal</option>
        <option value="Eastern Cape">Eastern Cape</option>
        <option value="Free State">Free State</option>
        <option value="North West">North West</option>
        <option value="Limpopo">Limpopo</option>
        <option value="Mpumalanga">Mpumalanga</option>
        <option value="Northern Cape">Northern Cape</option>
      </select>

      <select id="searchLocation">
        <option value="">Select Town / City</option>
      </select>

      <button id="searchBtn">Search</button>
    </div>
  </section>

  <h2 class="section-title">Browse by category</h2>
  <section class="categories" id="categoryList">
    <div class="category-card" data-category="Cars">
      <div class="category-icon">üöó</div>
      Cars
    </div>
    <div class="category-card" data-category="Phones">
      <div class="category-icon">üì±</div>
      Phones &amp; Tablets
    </div>
    <div class="category-card" data-category="Property">
      <div class="category-icon">üè†</div>
      Property
    </div>
    <div class="category-card" data-category="Electronics">
      <div class="category-icon">üíª</div>
      Electronics
    </div>
    <div class="category-card" data-category="Fashion & Beauty">
      <div class="category-icon">üíÑ</div>
      Fashion &amp; Beauty
    </div>
    <div class="category-card" data-category="Jobs">
      <div class="category-icon">üíº</div>
      Jobs
    </div>
    <div class="category-card" data-category="Other">
      <div class="category-icon">üì¶</div>
      Other
    </div>
  </section>

  <h2 class="section-title">All ads</h2>
  <div class="filters">
    <select id="filterCategory">
      <option value="">Category: All</option>
      <option value="Cars">Cars</option>
      <option value="Phones">Phones &amp; Tablets</option>
      <option value="Property">Property</option>
      <option value="Electronics">Electronics</option>
      <option value="Fashion &amp; Beauty">Fashion &amp; Beauty</option>
      <option value="Jobs">Jobs</option>
      <option value="Other">Other</option>
    </select>
    <select id="filterSort">
      <option value="newest">Sort: Newest</option>
      <option value="priceLow">Price: Low to High</option>
      <option value="priceHigh">Price: High to Low</option>
    </select>
  </div>

  <section class="ads-grid" id="adsGrid"></section>

  <footer>
    <div style="max-width:1100px; margin:0 auto; text-align:left; display:grid; grid-template-columns:repeat(auto-fit,minmax(180px,1fr)); gap:20px; padding:20px 10px;">

      <div>
        <h4 style="font-size:0.9rem; font-weight:700; margin-bottom:6px;">Account</h4>
        <p><a href="my-account.html">My Account</a></p>
        <p><a href="track-order.html">Track Order</a></p>
        <p><a href="returns.html">Returns</a></p>
        <p><a href="personal-details.html">Personal Details</a></p>
        <p><a href="invoices.html">Invoices</a></p>
      </div>

      <div>
        <h4 style="font-size:0.9rem; font-weight:700; margin-bottom:6px;">Help</h4>
        <p><a href="help-centre.html">Help Centre</a></p>
        <p><a href="contact-us.html">Contact Us</a></p>
        <p><a href="shipping-delivery.html">Shipping & Delivery</a></p>
        <p><a href="returns.html">Returns</a></p>
      </div>

      <div>
        <h4 style="font-size:0.9rem; font-weight:700; margin-bottom:6px;">Company</h4>
        <p><a href="about-us.html">About Us</a></p>
      </div>

      <div>
        <h4 style="font-size:0.9rem; font-weight:700; margin-bottom:6px;">Classifind Policy</h4>
        <p><a href="returns-policy.html">Returns Policy</a></p>
        <p><a href="terms-conditions.html">Terms & Conditions</a></p>
        <p><a href="privacy-policy.html">Privacy Policy</a></p>
      </div>

    </div>
    <div style="text-align:center; margin-top:20px; font-size:0.8rem; color:#666;">&copy; <span id="year"></span> ClassiFind. Inspired by global classifieds, built for you.</div>
  </footer>
</main>

<!-- Ad details modal -->
<div class="modal-backdrop" id="modalBackdrop">
  <div class="modal">
    <div class="modal-header">
      <h2 id="modalTitle">Ad title</h2>
      <button class="close-btn" id="modalClose">&times;</button>
    </div>
    <div class="modal-body">
      <div>
        <div id="modalImg" class="modal-img"></div>
        <p style="font-size:0.85rem; margin-top:6px;" id="modalPrice"></p>
        <p style="font-size:0.8rem; color:#555;" id="modalLocation"></p>
      </div>
      <div>
        <div>
          <div class="modal-section-title">Description</div>
          <p id="modalDescription" style="font-size:0.9rem; line-height:1.4;"></p>
        </div>
        <div style="margin-top:10px;">
          <div class="modal-section-title">Seller</div>
          <p id="modalSeller" style="font-size:0.9rem;"></p>
          <button class="contact-btn" id="contactBtn">Contact seller</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Login modal -->
<div class="auth-backdrop" id="loginBackdrop">
  <div class="auth-modal">
    <div class="auth-header">
      <h2>Login</h2>
      <button class="auth-close" id="loginClose">&times;</button>
    </div>
    <div class="auth-body">
      <label for="loginEmail">Email or Phone</label>
      <input id="loginEmail" type="text" placeholder="you@example.com" />

      <label for="loginPassword">Password</label>
      <input id="loginPassword" type="password" placeholder="Enter your password" />

      <button class="auth-submit" id="loginSubmit">Login</button>
      <div class="auth-actions">
        <span>New here?
          <span id="goToSignup" class="auth-link">Create an account</span>
        </span>
      </div>
    </div>
  </div>
</div>

<!-- Sign up modal -->
<div class="auth-backdrop" id="signupBackdrop">
  <div class="auth-modal">
    <div class="auth-header">
      <h2>Sign up</h2>
      <button class="auth-close" id="signupClose">&times;</button>
    </div>
    <div class="auth-body">
      <label for="signupName">Full name</label>
      <input id="signupName" type="text" placeholder="Your name" />

      <label for="signupEmail">Email</label>
      <input id="signupEmail" type="email" placeholder="you@example.com" />

      <label for="signupPhone">Phone (optional)</label>
      <input id="signupPhone" type="tel" placeholder="e.g. 072 123 4567" />

      <div class="field-group">
        <label for="signupPassword">Password</label>
        <input id="signupPassword" type="password" placeholder="Create a password" />
        <button type="button" class="toggle-password" data-target="signupPassword">üëÅ</button>
        <div id="passwordStrength" class="password-strength">
          <div class="bar"></div>
          <span class="label">Enter a password</span>
        </div>
      </div>

      <div class="field-group">
        <label for="signupPasswordConfirm">Confirm Password</label>
        <input id="signupPasswordConfirm" type="password" placeholder="Re-enter your password" />
        <button type="button" class="toggle-password" data-target="signupPasswordConfirm">üëÅ</button>
        <div id="passwordMatchMsg" class="password-match-msg"></div>
      </div>

      <button class="auth-submit" id="signupSubmit">Create account</button>
      <div class="auth-actions">
        <span>Already have an account?
          <span id="goToLogin" class="auth-link">Login</span>
        </span>
      </div>
    </div>
  </div>
</div>

<!-- Post Ad modal -->
<div class="postad-backdrop" id="postAdBackdrop">
  <div class="postad-modal">
    <div class="postad-header">
      <h2>Post an Ad</h2>
      <button class="postad-close" id="postAdClose">&times;</button>
    </div>
    <div class="postad-body">
      <label for="postCategory">Category</label>
      <select id="postCategory">
        <option value="">Select category</option>
        <option value="Cars">Cars</option>
        <option value="Phones">Phones &amp; Tablets</option>
        <option value="Property">Property</option>
        <option value="Electronics">Electronics</option>
        <option value="Fashion &amp; Beauty">Fashion &amp; Beauty</option>
        <option value="Jobs">Jobs</option>
        <option value="Other">Other</option>
      </select>

      <label for="postTitle">Ad title</label>
      <input id="postTitle" type="text" placeholder="e.g. VW Polo 1.4 Trendline, excellent condition" />

      <label for="postDescription">Description</label>
      <textarea id="postDescription" placeholder="Describe the item, condition, mileage, features, etc."></textarea>

      <label for="postPrice">Price (R)</label>
      <input id="postPrice" type="number" min="0" placeholder="e.g. 145000" />

      <label for="postLocation">Location (Town / City)</label>
      <input id="postLocation" type="text" placeholder="e.g. Klerksdorp, Johannesburg, Cape Town" />

      <label for="postSellerName">Your name</label>
      <input id="postSellerName" type="text" placeholder="Your name or business" />

      <label for="postContact">Contact (phone / email)</label>
      <input id="postContact" type="text" placeholder="e.g. 072 123 4567 or you@example.com" />

      <label for="postImageUrl">Image URL (optional)</label>
      <input id="postImageUrl" type="url" placeholder="Paste an image link (jpg, png...)" />

      <label for="postImageFiles">Upload images</label>
      <input id="postImageFiles" type="file" accept="image/*" multiple capture="environment" />
      <p class="postad-note">You can upload photos from your device or take a picture if your phone supports it.</p>

      <button class="postad-submit" id="postAdSubmit">Post Ad</button>
      <p class="postad-note">
        * Demo only ‚Äì ads are stored in the browser memory. Reloading the page will clear them.
      </p>
    </div>
  </div>
</div>

<script>
const supabaseClient = window.supabaseClient;
// --- Ads will be loaded from Supabase ---
let ads = [];
  const adsGrid = document.getElementById("adsGrid");
  const filterCategory = document.getElementById("filterCategory");
  const filterSort = document.getElementById("filterSort");
  const searchText = document.getElementById("searchText");
  const searchLocation = document.getElementById("searchLocation");
  const provinceSelect = document.getElementById("provinceSelect");

  // --- Province ‚Üí Towns map ---
  const provinceAreas = {
    "Gauteng": [
      "Johannesburg","Soweto","Pretoria","Centurion","Sandton","Midrand","Randburg","Roodepoort",
      "Krugersdorp","Alberton","Benoni","Boksburg","Brakpan","Springs","Germiston","Kempton Park",
      "Tembisa","Katlehong","Vosloorus","Mamelodi","Soshanguve","Ga-Rankuwa","Vanderbijlpark",
      "Vereeniging","Heidelberg","Nigel","Cullinan","Bronkhorstspruit","Carletonville",
      "Westonaria","Randfontein","Lenasia","Diepsloot","Tsakane","Daveyton","Edenvale","Bedfordview"
    ],
    "Western Cape": [
      "Cape Town","Bellville","Brackenfell","Durbanville","Goodwood","Parow","Kraaifontein",
      "Kuils River","Mitchells Plain","Khayelitsha","Fish Hoek","Muizenberg","Somerset West",
      "Strand","Gordons Bay","Stellenbosch","Paarl","Wellington","Franschhoek","Worcester",
      "Ceres","Robertson","George","Mossel Bay","Oudtshoorn","Knysna","Plettenberg Bay",
      "Beaufort West","Vredenburg","Saldanha","Malmesbury","Langebaan"
    ],
    "KwaZulu-Natal": [
      "Durban","Umlazi","Chatsworth","Phoenix","Pinetown","Westville","Hillcrest","Kloof",
      "Queensburgh","Umbilo","Isipingo","Umkomaas","Amanzimtoti","Umhlanga","Ballito","Stanger",
      "Richards Bay","Empangeni","Eshowe","Mtunzini","Port Shepstone","Margate","Ramsgate",
      "Harding","Pietermaritzburg","Howick","Mooi River","Greytown","Newcastle","Ladysmith",
      "Estcourt","Vryheid","Dundee","Bergville"
    ],
    "Eastern Cape": [
      "Gqeberha","Uitenhage","Despatch","East London","Mdantsane","King William's Town","Qonce",
      "Bhisho","Butterworth","Mthatha","Queenstown","Aliwal North","Makhanda","Graaff-Reinet",
      "Cradock","Port Alfred","Jeffreys Bay","Humansdorp","Kirkwood","Fort Beaufort","Alice",
      "Stutterheim","Mount Frere","Matatiele","Lusikisiki","Port St Johns"
    ],
    "Free State": [
      "Bloemfontein","Botshabelo","Thaba Nchu","Welkom","Virginia","Hennenman","Odendaalsrus",
      "Kroonstad","Sasolburg","Parys","Vredefort","Phuthaditjhaba","Bethlehem","Reitz",
      "Harrismith","Clocolan","Ladybrand","Ficksburg","Fouriesburg","Warden","Heilbron",
      "Viljoenskroon","Frankfort","Deneysville"
    ],
    "North West": [
      "Mahikeng","Mmabatho","Rustenburg","Klerksdorp","Jouberton","Orkney","Stilfontein",
      "Potchefstroom","Ikageng","Vryburg","Lichtenburg","Zeerust","Schweizer-Reneke","Bloemhof",
      "Christiana","Brits","Hartebeespoort","Mogwase","Sun City","Ventersdorp","Coligny","Swartruggens"
    ],
    "Limpopo": [
      "Polokwane","Seshego","Lebowakgomo","Mankweng","Thohoyandou","Sibasa","Louis Trichardt",
      "Makhado","Musina","Tzaneen","Letsitele","Phalaborwa","Giyani","Malamulele","Burgersfort",
      "Mokopane","Mahwelereng","Modimolle","Bela-Bela","Lephalale","Thabazimbi","Dendron","Botlokwa"
    ],
    "Mpumalanga": [
      "Mbombela","Nelspruit","White River","Hazyview","Sabie","Graskop","Lydenburg","Mashishing",
      "Barberton","Malelane","Komatipoort","Ermelo","Secunda","Trichardt","Bethal","Standerton",
      "Middelburg","eMalahleni","Witbank","Ogies","Delmas","Volksrust","Carolina","Mkhondo","Piet Retief"
    ],
    "Northern Cape": [
      "Kimberley","Barkly West","Warrenton","Jan Kempdorp","Hartswater","Upington","Keimoes",
      "Kakamas","Groblershoop","Prieska","De Aar","Britstown","Victoria West","Strydenburg",
      "Colesberg","Springbok","Okiep","Concordia","Pofadder","Port Nolloth","Alexander Bay",
      "Kuruman","Kathu","Postmasburg","Danielskuil"
    ]
  };

  function populateTownsForProvince(province) {
    searchLocation.innerHTML = "";
    const defaultOption = document.createElement("option");
    defaultOption.value = "";
    defaultOption.textContent = "Select Town / City";
    searchLocation.appendChild(defaultOption);

    if (province === "All provinces") {
      return; // leave only default
    }

    const towns = provinceAreas[province] || [];
    towns.forEach(town => {
      const option = document.createElement("option");
      option.value = town;
      option.textContent = town;
      searchLocation.appendChild(option);
    });
  }

  provinceSelect.addEventListener("change", () => {
    populateTownsForProvince(provinceSelect.value);
    applyFilters();
  });

  function renderAds(list) {
    adsGrid.innerHTML = "";
    if (!list.length) {
      adsGrid.innerHTML = "<p>No ads found. Try changing your filters.</p>";
      return;
    }

    list.forEach(ad => {
      const card = document.createElement("article");
      card.className = "ad-card";
      card.dataset.id = ad.id;

      const imgDiv = document.createElement("div");
      imgDiv.className = "ad-image";
      imgDiv.style.backgroundImage = `url('${ad.img || "https://via.placeholder.com/400x300?text=No+Image"}')`;

      const body = document.createElement("div");
      body.className = "ad-body";

      const price = document.createElement("div");
      price.className = "ad-price";
      price.textContent = ad.price > 0 ? "R " + Number(ad.price).toLocaleString() : "Price on request";

      const title = document.createElement("div");
      title.className = "ad-title";
      title.textContent = ad.title;

      const location = document.createElement("div");
      location.className = "ad-location";
      location.textContent = ad.location + " ‚Ä¢ " + ad.category;

      const meta = document.createElement("div");
      meta.className = "ad-meta";
      meta.textContent = "Posted: " + ad.postedAt;

      body.appendChild(price);
      body.appendChild(title);
      body.appendChild(location);
      body.appendChild(meta);

      card.appendChild(imgDiv);
      card.appendChild(body);

      card.addEventListener("click", () => openModal(ad.id));

      adsGrid.appendChild(card);
    });
  }
async function fetchAdsFromSupabase() {
  const { data, error } = await supabaseClient
    .from("ads")
    .select("*")
    .order("created_at", { ascending: false });

  if (error) {
    console.error("Error fetching ads from Supabase:", error);
    return;
  }

  ads = (data || []).map(row => ({
    id: row.id,
    title: row.title,
    price: row.price || 0,
    category: row.category,
    location: row.location,
    img: row.image_url || "",
    description: row.description,
    seller: row.seller_name || (row.contact ? row.contact : "Private seller"),
    postedAt: row.created_at ? row.created_at.slice(0, 10) : ""
  }));

  applyFilters();
}
  function applyFilters() {
    let list = [...ads];

    const text = searchText.value.trim().toLowerCase();
    if (text) {
      list = list.filter(ad =>
        ad.title.toLowerCase().includes(text) ||
        ad.description.toLowerCase().includes(text)
      );
    }

    const province = provinceSelect.value;
    const loc = searchLocation.value;

    if (province && province !== "All provinces") {
      list = list.filter(ad => {
        // simple match: check if ad.location is in province towns
        const towns = provinceAreas[province] || [];
        return towns.includes(ad.location) || ad.location.toLowerCase().includes(province.toLowerCase());
      });
    }

    if (loc) {
      list = list.filter(ad => ad.location === loc);
    }

    const cat = filterCategory.value;
    if (cat) {
      list = list.filter(ad => ad.category === cat);
    }

    const sort = filterSort.value;
    if (sort === "priceLow") {
      list.sort((a, b) => (a.price || 0) - (b.price || 0));
    } else if (sort === "priceHigh") {
      list.sort((a, b) => (b.price || 0) - (a.price || 0));
    } else if (sort === "newest") {
      list.sort((a, b) => new Date(b.postedAt) - new Date(a.postedAt));
    }

    renderAds(list);
  }

  document.getElementById("searchBtn").addEventListener("click", applyFilters);
  filterCategory.addEventListener("change", applyFilters);
  filterSort.addEventListener("change", applyFilters);
  searchLocation.addEventListener("change", applyFilters);
  searchText.addEventListener("keyup", (e) => {
    if (e.key === "Enter") applyFilters();
  });

  document.getElementById("categoryList").addEventListener("click", (e) => {
    const card = e.target.closest(".category-card");
    if (!card) return;
    const cat = card.dataset.category;
    filterCategory.value = cat;
    applyFilters();
    const filtersEl = document.querySelector(".filters");
    if (filtersEl) {
      window.scrollTo({ top: filtersEl.offsetTop - 60, behavior: "smooth" });
    }
  });

  // --- Ad modal ---
  const modalBackdrop = document.getElementById("modalBackdrop");
  const modalClose = document.getElementById("modalClose");
  const modalTitle = document.getElementById("modalTitle");
  const modalImg = document.getElementById("modalImg");
  const modalPrice = document.getElementById("modalPrice");
  const modalLocation = document.getElementById("modalLocation");
  const modalDescription = document.getElementById("modalDescription");
  const modalSeller = document.getElementById("modalSeller");
  const contactBtn = document.getElementById("contactBtn");

  function openModal(id) {
    const ad = ads.find(a => a.id === id);
    if (!ad) return;

    modalTitle.textContent = ad.title;
    modalImg.style.backgroundImage = `url('${ad.img || "https://via.placeholder.com/400x300?text=No+Image"}')`;
    modalPrice.textContent = ad.price > 0 ? "Price: R " + Number(ad.price).toLocaleString() : "Price on request";
    modalLocation.textContent = ad.location + " ‚Ä¢ " + ad.category;
    modalDescription.textContent = ad.description;
    modalSeller.textContent = ad.seller || (ad.seller_name || "Private seller");
    contactBtn.onclick = () => {
      alert("In a real app this would open chat / WhatsApp / email to contact the seller.");
    };

    modalBackdrop.style.display = "flex";
  }

  modalClose.addEventListener("click", () => {
    modalBackdrop.style.display = "none";
  });

  modalBackdrop.addEventListener("click", (e) => {
    if (e.target === modalBackdrop) {
      modalBackdrop.style.display = "none";
    }
  });

  // --- Auth modals ---
  const loginBtn = document.getElementById("loginBtn");
  const signupBtn = document.getElementById("signupBtn");
  const loginBackdrop = document.getElementById("loginBackdrop");
  const signupBackdrop = document.getElementById("signupBackdrop");
  const loginClose = document.getElementById("loginClose");
  const signupClose = document.getElementById("signupClose");
  const loginSubmit = document.getElementById("loginSubmit");
  const signupSubmit = document.getElementById("signupSubmit");
  const signupPassword = document.getElementById("signupPassword");
  const signupPasswordConfirm = document.getElementById("signupPasswordConfirm");
  const passwordStrengthEl = document.getElementById("passwordStrength");
  const passwordStrengthBar = passwordStrengthEl.querySelector(".bar");
  const passwordStrengthLabel = passwordStrengthEl.querySelector(".label");
  const passwordMatchMsg = document.getElementById("passwordMatchMsg");
  const togglePasswordButtons = document.querySelectorAll(".toggle-password");
  const goToSignup = document.getElementById("goToSignup");
  const goToLogin = document.getElementById("goToLogin");

  function openLogin() {
    loginBackdrop.style.display = "flex";
  }

  function openSignup() {
    signupBackdrop.style.display = "flex";
  }

  loginBtn.addEventListener("click", openLogin);
  signupBtn.addEventListener("click", openSignup);

  loginClose.addEventListener("click", () => { loginBackdrop.style.display = "none"; });
  signupClose.addEventListener("click", () => { signupBackdrop.style.display = "none"; });

  loginBackdrop.addEventListener("click", (e) => {
    if (e.target === loginBackdrop) loginBackdrop.style.display = "none";
  });

  signupBackdrop.addEventListener("click", (e) => {
    if (e.target === signupBackdrop) signupBackdrop.style.display = "none";
  });

  if (goToSignup) {
    goToSignup.addEventListener("click", () => {
      loginBackdrop.style.display = "none";
      signupBackdrop.style.display = "flex";
    });
  }

  if (goToLogin) {
    goToLogin.addEventListener("click", () => {
      signupBackdrop.style.display = "none";
      loginBackdrop.style.display = "flex";
    });
  }

  function evaluatePasswordStrength(pw) {
    let score = 0;
    if (pw.length >= 8) score++;
    if (/[0-9]/.test(pw)) score++;
    if (/[A-Z]/.test(pw)) score++;
    if (/[^A-Za-z0-9]/.test(pw)) score++;
    return score;
  }

  function updatePasswordStrength() {
    const pw = signupPassword.value || "";
    passwordStrengthEl.classList.remove("weak", "medium", "strong");

    if (!pw) {
      passwordStrengthBar.style.width = "0";
      passwordStrengthLabel.textContent = "Enter a password";
      return;
    }

    const score = evaluatePasswordStrength(pw);
    if (score <= 1) {
      passwordStrengthEl.classList.add("weak");
      passwordStrengthLabel.textContent = "Weak";
    } else if (score === 2 || score === 3) {
      passwordStrengthEl.classList.add("medium");
      passwordStrengthLabel.textContent = "Medium";
    } else {
      passwordStrengthEl.classList.add("strong");
      passwordStrengthLabel.textContent = "Strong";
    }
  }

  function updatePasswordMatch() {
    const pw = signupPassword.value || "";
    const confirm = signupPasswordConfirm.value || "";

    signupPassword.style.borderColor = "";
    signupPasswordConfirm.style.borderColor = "";
    passwordMatchMsg.textContent = "";
    passwordMatchMsg.classList.remove("ok", "error");

    if (!confirm) return;

    if (pw && pw === confirm) {
      passwordMatchMsg.textContent = "Passwords match";
      passwordMatchMsg.classList.add("ok");
      signupPassword.style.borderColor = "#2e7d32";
      signupPasswordConfirm.style.borderColor = "#2e7d32";
    } else {
      passwordMatchMsg.textContent = "Passwords do not match";
      passwordMatchMsg.classList.add("error");
      signupPassword.style.borderColor = "#c62828";
      signupPasswordConfirm.style.borderColor = "#c62828";
    }
  }

  signupPassword.addEventListener("input", () => {
    updatePasswordStrength();
    updatePasswordMatch();
  });

  signupPasswordConfirm.addEventListener("input", updatePasswordMatch);

  togglePasswordButtons.forEach(btn => {
    btn.addEventListener("click", () => {
      const targetId = btn.getAttribute("data-target");
      const input = document.getElementById(targetId);
      if (!input) return;
      const isPassword = input.type === "password";
      input.type = isPassword ? "text" : "password";
      btn.textContent = isPassword ? "üôà" : "üëÅ";
    });
  });

  loginSubmit.addEventListener("click", () => {
    alert("Login submitted (demo only, no backend yet).");
  });

  signupSubmit.addEventListener("click", () => {
    const pw = signupPassword.value || "";
    const confirm = signupPasswordConfirm.value || "";

    updatePasswordMatch();

    if (!pw || !confirm) {
      alert("Please enter and confirm your password.");
      return;
    }

    if (pw !== confirm) {
      alert("Passwords do not match. Please fix them before continuing.");
      return;
    }

    alert("Sign-up submitted (demo only, no backend yet).");
  });

  // --- Post Ad modal logic ---
  const postAdBtn = document.getElementById("postAdBtn");
  const postAdBackdrop = document.getElementById("postAdBackdrop");
  const postAdClose = document.getElementById("postAdClose");
  const postAdSubmit = document.getElementById("postAdSubmit");

  postAdBtn.addEventListener("click", () => {
    postAdBackdrop.style.display = "flex";
  });

  postAdClose.addEventListener("click", () => {
    postAdBackdrop.style.display = "none";
  });

  postAdBackdrop.addEventListener("click", (e) => {
    if (e.target === postAdBackdrop) {
      postAdBackdrop.style.display = "none";
    }
  });

postAdSubmit.addEventListener("click", async () => {
  const category = document.getElementById("postCategory").value.trim();
  const title = document.getElementById("postTitle").value.trim();
  const description = document.getElementById("postDescription").value.trim();
  const price = document.getElementById("postPrice").value.trim();
  const location = document.getElementById("postLocation").value.trim();
  const sellerName = document.getElementById("postSellerName").value.trim();
  const contact = document.getElementById("postContact").value.trim();
  const imageUrlInput = document.getElementById("postImageUrl").value.trim();
  const imageFileInput = document.getElementById("postImageFiles");
  const imageFile = imageFileInput ? imageFileInput.files[0] : null;
  if (!category || !title || !description || !location) {
    alert("Please fill in at least category, title, description, and location.");
    return;
  }

  let finalImageUrl = imageUrlInput || "";

  // 1) If user selected an image file, upload it to Supabase Storage
  if (imageFile) {
    const fileExt = imageFile.name.split(".").pop();
    const fileName = `${Date.now()}-${Math.random().toString(36).slice(2)}.${fileExt}`;
    const filePath = `ads/${fileName}`;

    const { data: storageData, error: storageError } = await supabaseClient
      .storage
      .from("ad-images") // bucket name
      .upload(filePath, imageFile);

    if (storageError) {
      console.error("Error uploading image:", storageError);
      alert("Failed to upload image. You can try again or use an image URL instead.");
      return;
    }

    const { data: publicUrlData } = supabaseClient
      .storage
      .from("ad-images")
      .getPublicUrl(filePath);

    finalImageUrl = publicUrlData.publicUrl;
  }

  // 2) Insert ad into Supabase table
  const { data, error } = await supabaseClient
    .from("ads")
    .insert({
      title,
      description,
      category,
      price: price ? Number(price) : null,
      location,
      province: provinceSelect.value === "All provinces" ? null : provinceSelect.value,
      seller_name: sellerName || null,
      contact: contact || null,
      image_url: finalImageUrl || null
    })
    .select()
    .single();

  if (error) {
    console.error("Error inserting ad:", error);
    alert("Could not save your ad. Please try again.");
    return;
  }

  // 3) Add new ad to local list & refresh UI
  const newAd = {
    id: data.id,
    title: data.title,
    price: data.price || 0,
    category: data.category,
    location: data.location,
    img: data.image_url || "",
    description: data.description,
    seller: data.seller_name || (data.contact ? data.contact : "Private seller"),
    postedAt: data.created_at ? data.created_at.slice(0, 10) : ""
  };

  ads.unshift(newAd);
  applyFilters();

  alert("Your ad has been posted! üéâ");

  // Clear fields
  document.getElementById("postCategory").value = "";
  document.getElementById("postTitle").value = "";
  document.getElementById("postDescription").value = "";
  document.getElementById("postPrice").value = "";
  document.getElementById("postLocation").value = "";
  document.getElementById("postSellerName").value = "";
  document.getElementById("postContact").value = "";
  document.getElementById("postImageUrl").value = "";
  if (imageFileInput) imageFileInput.value = "";

  postAdBackdrop.style.display = "none";
});
  document.getElementById("year").textContent = new Date().getFullYear();

  // Initial setup
  populateTownsForProvince("All provinces");
  fetchAdsFromSupabase ();
</script>
</body>
</html>
